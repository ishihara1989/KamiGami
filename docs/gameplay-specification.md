# KamiGami Mod - ゲームプレイ仕様書

このドキュメントは、KamiGamiモッドの**ゲームプレイ上の仕様**を定義します。

## 目次
1. [式神システム概要](#式神システム概要)
2. [召喚システム](#召喚システム)
3. [式神の基本特性](#式神の基本特性)
4. [実装済みの式神](#実装済みの式神)
5. [仕様の実装チェックリスト](#仕様の実装チェックリスト)

---

## 式神システム概要

### コンセプト
**式神（しきがみ）** は、紙で作られた召喚可能なエンティティです。バニラの動物と似た動作をしますが、以下の特徴があります：

- **脆弱性**: 通常の動物よりも低いHPを持つ
- **繁殖不可**: 繁殖できず、発情モードにも入らない
- **リサイクル可能**: 倒すと召喚アイテムをドロップする
- **資源取得**: バニラと同様に特定の資源を取得できる（ミルク、卵、羊毛など）

### デザイン哲学
式神は**使い捨てだが再利用可能**な召喚生物として設計されています。プレイヤーは以下の用途で使用できます：

- 一時的な資源取得（牧畜の代替）
- 装飾や雰囲気作り
- バニラの動物が手に入らない序盤の代替手段

---

## 召喚システム

### 召喚方法
1. **召喚アイテム**（例: 紙の牛召喚）を持つ
2. **ブロックを右クリック**する
3. クリックした位置に式神が召喚される

### アイテムの消費
- **サバイバルモード**: 召喚アイテムは消費される
- **クリエイティブモード**: 消費されない

### スタックサイズ
- すべての召喚アイテムは**最大16個**までスタック可能

### 実装ファイル
- [ShikigamiSummonItem.java](../src/main/java/com/hydryhydra/kamigami/item/ShikigamiSummonItem.java)

---

## 式神の基本特性

### 共通仕様

| 特性 | 仕様 | 備考 |
|------|------|------|
| **HP** | 低い（4.0～6.0 = 2～3ハート） | エンティティごとに異なる |
| **繁殖** | ❌ 不可 | `getBreedOffspring()` は `null` を返す |
| **発情モード** | ❌ 不可 | `BreedGoal` は登録されない |
| **子供** | ✅ 可能 | NBTで設定可能だが、自然には発生しない |
| **デスポーン** | ❌ しない | 通常の動物と同様 |
| **ドロップ** | 召喚アイテムのみ | バニラの動物と異なり、肉や皮は落とさない |

### HPの設定

各式神のHPは、バニラの動物よりも低く設定されています：

| 式神 | HP | バニラ動物のHP |
|------|----|----|
| 紙の牛 | 6.0 (3ハート) | 10.0 (5ハート) |
| 紙の鶏 | 4.0 (2ハート) | 4.0 (2ハート) |
| 紙の羊 | 5.0 (2.5ハート) | 8.0 (4ハート) |

### AIの動作

式神は**バニラの動物と同じAI**を持ちますが、以下の違いがあります：

#### ✅ 実装されているAI
- 水中で浮く (`FloatGoal`)
- パニック逃走 (`PanicGoal`)
- 食べ物に誘引される (`TemptGoal`)
- 親を追従する (`FollowParentGoal`)
- ランダムに歩き回る (`WaterAvoidingRandomStrollGoal`)
- プレイヤーを見る (`LookAtPlayerGoal`)
- ランダムに周囲を見る (`RandomLookAroundGoal`)

#### ❌ 実装されていないAI
- **繁殖AI (`BreedGoal`)**: 意図的に除外
- 他の動物との交配や発情行動は一切行わない

### 基底クラス
[ShikigamiEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/ShikigamiEntity.java)

---

## 実装済みの式神

### 1. 紙の牛 (Paper Cow)

#### 基本情報
- **登録名**: `paper_cow`
- **HP**: 6.0 (3ハート)
- **サイズ**: 0.9F x 1.4F
- **移動速度**: 0.25D

#### ゲームプレイ機能
| 機能 | 仕様 | 実装状況 |
|------|------|----------|
| **ミルクの取得** | ✅ バケツで取得可能 | 実装済み |
| **誘引アイテム** | 小麦 | 実装済み |
| **繁殖** | ❌ 不可 | 正しく無効化済み |
| **ドロップ** | 召喚アイテムのみ | 実装済み |

#### 実装ファイル
- Entity: [PaperCowEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/PaperCowEntity.java)
- Loot Table: [paper_cow.json](../src/main/resources/data/kamigami/loot_table/entities/paper_cow.json)

---

### 2. 紙の鶏 (Paper Chicken)

#### 基本情報
- **登録名**: `paper_chicken`
- **HP**: 4.0 (2ハート)
- **サイズ**: 0.4F x 0.7F
- **移動速度**: 0.25D

#### ゲームプレイ機能
| 機能 | 仕様 | 実装状況 |
|------|------|----------|
| **卵を産む** | ✅ 定期的に卵を産む（6000～12000tick） | 実装済み |
| **誘引アイテム** | 各種種（小麦の種、メロンの種、など） | 実装済み |
| **繁殖** | ❌ 不可 | 正しく無効化済み |
| **ドロップ** | 召喚アイテムのみ | 実装済み |

#### 産卵の仕様
- 産卵間隔: 6000～12000tick（5～10分）
- 条件: 生存、成体、サーバー側のみ
- 実装場所: [PaperChickenEntity.java:53-62](../src/main/java/com/hydryhydra/kamigami/entity/PaperChickenEntity.java#L53-L62)

#### 実装ファイル
- Entity: [PaperChickenEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/PaperChickenEntity.java)
- Loot Table: [paper_chicken.json](../src/main/resources/data/kamigami/loot_table/entities/paper_chicken.json)

---

### 3. 紙の羊 (Paper Sheep)

#### 基本情報
- **登録名**: `paper_sheep`
- **HP**: 5.0 (2.5ハート)
- **サイズ**: 0.9F x 1.3F
- **移動速度**: 0.25D

#### ゲームプレイ機能
| 機能 | 仕様 | 実装状況 |
|------|------|----------|
| **羊毛の取得** | ✅ ハサミで刈り取り可能（白色の羊毛1～3個） | 実装済み |
| **羊毛の再生** | ✅ 草を食べることで再生 | 実装済み |
| **誘引アイテム** | 小麦 | 実装済み |
| **繁殖** | ❌ 不可 | 正しく無効化済み |
| **ドロップ** | 召喚アイテムのみ | 実装済み |

#### 刈り取りの仕様
- ハサミで右クリック
- 1～3個の白色の羊毛を落とす
- 刈り取り状態は `EntityDataAccessor` で管理
- 草を食べると羊毛が再生

#### 羊毛の色
- **現在**: 白色固定
- **将来**: 染色機能を追加予定（バニラの羊と同様）

#### 実装ファイル
- Entity: [PaperSheepEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/PaperSheepEntity.java)
- Loot Table: [paper_sheep.json](../src/main/resources/data/kamigami/loot_table/entities/paper_sheep.json)

---

## ドロップ仕様の詳細

### 共通ルール
すべての式神は、倒されると**召喚アイテムをドロップ**します。

#### Loot Table仕様
```json
{
  "type": "minecraft:entity",
  "pools": [
    {
      "rolls": 1,
      "entries": [
        {
          "type": "minecraft:item",
          "name": "kamigami:<summon_item_name>"
        }
      ]
    }
  ]
}
```

### 重要な仕様
- **条件なし**: プレイヤーに倒されなくてもドロップする
- **確定ドロップ**: 必ず1個ドロップ
- **召喚アイテムのみ**: バニラの肉、皮、羽などはドロップしない

### リサイクルの利点
式神を倒すと召喚アイテムが戻ってくるため、以下のメリットがあります：

1. **無限再召喚**: アイテムを失わずに式神を使い続けられる
2. **移動手段**: 式神を倒してアイテム化し、別の場所で再召喚できる
3. **在庫管理**: 不要な式神を倒してインベントリを整理できる

---

## 資源取得の詳細

### 取得可能な資源

| 式神 | 資源 | 取得方法 | バニラとの違い |
|------|------|----------|----------------|
| 紙の牛 | ミルク | バケツで右クリック | 同じ |
| 紙の鶏 | 卵 | 自動的に産む | 同じ |
| 紙の羊 | 白色の羊毛 | ハサミで刈り取り | 色が白色固定 |

### 取得不可能な資源
以下のバニラ資源は取得できません：

- **生の牛肉・革** (牛)
- **生の鶏肉・羽** (鶏)
- **生の羊肉** (羊)

これにより、式神は**完全な代替手段ではなく、補助的な存在**として機能します。

---

## 仕様の実装チェックリスト

新しい式神を追加する際や、既存の式神を確認する際に使用してください。

### 基本チェック

- [ ] HPが低く設定されている（バニラより低い）
- [ ] `getBreedOffspring()` が `null` を返す
- [ ] `BreedGoal` が `registerGoals()` に登録されていない
- [ ] Loot Tableが召喚アイテムのみをドロップする
- [ ] 召喚アイテムのスタック数が16に設定されている

### AI動作チェック

- [ ] `FloatGoal` が登録されている
- [ ] `PanicGoal` が登録されている
- [ ] `TemptGoal` が適切な食べ物で登録されている
- [ ] `WaterAvoidingRandomStrollGoal` が登録されている
- [ ] `LookAtPlayerGoal` が登録されている

### エンティティ固有機能チェック

#### 紙の牛
- [ ] バケツでミルクが取得できる
- [ ] 小麦で誘引される

#### 紙の鶏
- [ ] 定期的に卵を産む
- [ ] 各種種で誘引される

#### 紙の羊
- [ ] ハサミで羊毛が刈り取れる
- [ ] 草を食べて羊毛が再生する
- [ ] 小麦で誘引される

### ファイル構成チェック

- [ ] エンティティクラスが存在する
- [ ] Loot Tableが存在する
- [ ] 召喚アイテムが登録されている
- [ ] クリエイティブタブに追加されている
- [ ] 翻訳ファイルにエントリがある

---

## 将来の拡張案

### 追加予定の機能
以下の機能は現在未実装ですが、将来的に追加を検討しています：

1. **式神の色バリエーション**
   - 紙の羊の染色機能
   - 紙の鶏、紙の牛のバリエーション

2. **新しい式神**
   - 紙の豚（キャロットで誘引、サドル騎乗可能）
   - 紙のウサギ（小さく素早い）
   - 紙の馬（騎乗可能）

3. **召喚アイテムのクラフトレシピ**
   - 式神コアアイテムを使用したレシピ
   - 紙 + 特定のアイテムで召喚アイテムを作成

4. **式神の強化システム**
   - アイテムを使ってHPや能力を強化
   - レベルアップシステム

5. **式神の視覚的差別化**
   - テクスチャの追加（現在未作成）
   - パーティクルエフェクト
   - 紙らしいアニメーション

---

## 仕様変更履歴

### 2025-11-07
- **繁殖システムの完全無効化**
  - すべての式神から `BreedGoal` を削除
  - これにより発情モードが発生しないようになった
- **Loot Tableの統一**
  - `paper_sheep.json` から `killed_by_player` 条件を削除
  - すべての式神が常に召喚アイテムをドロップするよう統一
- **PaperSheepEntityのバグ修正**
  - NBT読み込み時の `.orElse()` エラーを修正
- **このドキュメントの初版作成**

---

## 開発者向けノート

### ゲームプレイ仕様の変更時
1. このドキュメントを更新する
2. 実装を確認する（チェックリスト使用）
3. コンパイルテストを実行する
4. 可能であればゲーム内テストを実施する

### 新しい式神の追加時
1. このドキュメントの「実装済みの式神」セクションに追記
2. チェックリストを使用して実装を確認
3. 仕様変更履歴に記録

### 参考リンク
- [エンティティ実装ガイド](entity-implementation-guide.md)
- [NeoForge注意点](neoforge-gotchas.md)
- [プロジェクト構造](project-structure.md)

---

**最終更新日**: 2025-11-07
**バージョン**: 1.0
**対象**: KamiGami Mod v0.0.1 (Minecraft 1.21.10 / NeoForge 21.10.43-beta)
