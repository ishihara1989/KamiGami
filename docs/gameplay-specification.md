# KamiGami Mod - ゲームプレイ仕様書

このドキュメントは、KamiGamiモッドの**ゲームプレイ上の仕様**を定義します。

## 目次
1. [祠システム](#祠システム)
2. [式神システム概要](#式神システム概要)
3. [召喚システム](#召喚システム)
4. [式神の基本特性](#式神の基本特性)
5. [実装済みの式神](#実装済みの式神)
6. [仕様の実装チェックリスト](#仕様の実装チェックリスト)

---

## 祠システム

### コンセプト
**祠（ほこら）** は、神秘的な力を宿すブロックで、このModの中心的要素です。基本的にプレイヤーに**恩恵**をもたらしますが、不用意に破壊すると**災い**が訪れます。災いは時として新たな可能性を生み出し、それを乗り越えたときには**より大きな恩恵**が得られます。

### 祠の基本機能

#### アイテム保管
- 祠は**1つのアイテム**を保管できる
- アイテムを持って右クリックで**保管**
- 空手で右クリックで**取り出し**
- クリエイティブモードでは保管時にアイテムを消費しない

#### 設置向き調整
- 通常設置: プレイヤーの反対方向を向く
- スニーク設置: 通常の180度回転（プレイヤー側を向く）

#### 破壊時の災い
祠を破壊する際、**シルクタッチのツール**を使用しているかどうかで挙動が変わります：

| 破壊方法 | 結果 |
|---------|------|
| **シルクタッチあり** | 祠ブロックがドロップ、保管アイテムもドロップ、災いなし |
| **シルクタッチなし** | 保管アイテムはドロップ、祠は破壊、**災いが発生** |

災いの種類は、祠に保管されていた**御神体**の種類によって異なります。

---

### 祠の災い（祟り）システム

#### 1. 通常の祠（御神体なし）
**召喚される祟り**: サイズ1の祟りスライム

- 小さめの爆発音とエフェクト
- HP: 4.0、攻撃力: 2.0
- 倒すと分裂せず、スライムボールまたはインクをドロップ

#### 2. 沼の神の御神体（Charm of Swamp Deity）
**召喚される祟り**: サイズ4の祟りスライム

**環境変化**:
- 周囲5×5、祠から1～3段下の範囲を処理
- 原木を削除
- 植物を骨粉に変換してドロップ
- 空いたマスに粘土・土・苔ブロックをランダムに配置（40%の確率）

**召喚されるモンスター**:
- サイズ4の祟りスライム（HP: 16.0、攻撃力: 4.0）
- 倒すとサイズ2×2体に分裂
- サイズ2はさらにサイズ1×2体に分裂

**効果音**: 大きめの爆発音

#### 3. 豊穣の御神体（Charm of Fertility）
**召喚される祟り**: 豊穣の祟り（Tatari of Fertility Deity）

**環境変化**:
- 周囲5×5、祠の高さから2段下までの範囲にブロックを配置
- 配置確率: 祠と同じ高さは40%、それ以下は100%
- 配置されるブロック: オークの原木、ポドゾル、砂利、砂、荒れた土

**召喚されるモンスター**:
- 豊穣の祟り（高さ4ブロックの木型モンスター）
- HP: 20.0、遠距離攻撃（ガスト型）
- 斧でのダメージ3倍
- 動かない（木なので）、ノックバック無効

**効果音**: 低めの大きい爆発音

---

### 祟りモンスター

#### 祟りスライム（Tatari Slime）
黒いスライム型の敵対モンスター。

**基本特性**:
- パーティクル: イカスミ
- 音: バニラのスライムと同じ
- AI: スライムと同様のジャンプ移動、プレイヤーとアイアンゴーレムを攻撃

**サイズ別ステータス**:

| サイズ | HP | 攻撃力 | 移動速度 | 分裂 |
|-------|----|----|---------|------|
| 4 | 16.0 | 4.0 | 0.6 | サイズ2×2 |
| 2 | 4.0 | 2.0 | 0.4 | サイズ1×2 |
| 1 | 1.0 | 1.0 | 0.3 | なし |

**ドロップアイテム**（サイズ1のみ）:
- スライムボール または インク

**実装ファイル**:
- [TatariSlimeEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/TatariSlimeEntity.java)

#### 豊穣の祟り（Tatari of Fertility Deity）
高さ4ブロックの木の幹にジャック・オ・ランタンの顔を持つモンスター。

**基本特性**:
- HP: 20.0
- 移動速度: 0.0（動かない）
- ノックバック耐性: 100%
- 攻撃範囲: 100ブロック
- 経験値: 10

**攻撃**:
- ガスト型の遠距離攻撃（火の玉）
- 爆発なし、ダメージ＋空腹効果を付与
- 攻撃間隔: 距離に応じて20～40tick

**弱点**:
- 斧でのダメージ**3倍**

**音**:
- 環境音: ガストの声
- 被ダメージ音: ガストの悲鳴
- 死亡音: ガストの死亡音

**実装ファイル**:
- [TatariFertilityEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/TatariFertilityEntity.java)

---

### 御神体アイテム

御神体は、祠に保管することで特別な災いを引き起こすアイテムです。

#### 沼の神の御神体（Charm of Swamp Deity）
- **登録名**: `charm_of_swamp_deity`
- **効果**: 祠破壊時にサイズ4の祟りスライムを召喚、周囲の原木を削除して沼地化

#### 豊穣の御神体（Charm of Fertility）
- **登録名**: `charm_of_fertility`
- **効果**: 祠破壊時に豊穣の祟りを召喚、周囲にブロックを配置

---

## 式神システム概要

### コンセプト
**式神（しきがみ）** は、紙で作られた召喚可能なエンティティです。バニラの動物と似た動作をしますが、以下の特徴があります：

- **脆弱性**: 通常の動物よりも低いHPを持つ
- **繁殖不可**: 繁殖できず、発情モードにも入らない
- **リサイクル可能**: 倒すと召喚アイテムをドロップする
- **資源取得**: バニラと同様に特定の資源を取得できる（ミルク、卵、羊毛など）

### デザイン哲学
式神は**使い捨てだが再利用可能**な召喚生物として設計されています。プレイヤーは以下の用途で使用できます：

- 一時的な資源取得（牧畜の代替）
- 装飾や雰囲気作り
- バニラの動物が手に入らない序盤の代替手段

---

## 召喚システム

### 召喚方法
1. **召喚アイテム**（例: 紙の牛召喚）を持つ
2. **ブロックを右クリック**する
3. クリックした位置に式神が召喚される

### アイテムの消費
- **サバイバルモード**: 召喚アイテムは消費される
- **クリエイティブモード**: 消費されない

### スタックサイズ
- すべての召喚アイテムは**最大16個**までスタック可能

### 実装ファイル
- [ShikigamiSummonItem.java](../src/main/java/com/hydryhydra/kamigami/item/ShikigamiSummonItem.java)

---

## 式神の基本特性

### 共通仕様

| 特性 | 仕様 | 備考 |
|------|------|------|
| **HP** | 低い（4.0～6.0 = 2～3ハート） | エンティティごとに異なる |
| **繁殖** | ❌ 不可 | `getBreedOffspring()` は `null` を返す |
| **発情モード** | ❌ 不可 | `BreedGoal` は登録されない |
| **子供** | ✅ 可能 | NBTで設定可能だが、自然には発生しない |
| **デスポーン** | ❌ しない | 通常の動物と同様 |
| **ドロップ** | 召喚アイテムのみ | バニラの動物と異なり、肉や皮は落とさない |

### HPの設定

各式神のHPは、バニラの動物よりも低く設定されています：

| 式神 | HP | バニラ動物のHP |
|------|----|----|
| 紙の牛 | 6.0 (3ハート) | 10.0 (5ハート) |
| 紙の鶏 | 4.0 (2ハート) | 4.0 (2ハート) |
| 紙の羊 | 5.0 (2.5ハート) | 8.0 (4ハート) |

### AIの動作

式神は**バニラの動物と同じAI**を持ちますが、以下の違いがあります：

#### ✅ 実装されているAI
- 水中で浮く (`FloatGoal`)
- パニック逃走 (`PanicGoal`)
- 食べ物に誘引される (`TemptGoal`)
- 親を追従する (`FollowParentGoal`)
- ランダムに歩き回る (`WaterAvoidingRandomStrollGoal`)
- プレイヤーを見る (`LookAtPlayerGoal`)
- ランダムに周囲を見る (`RandomLookAroundGoal`)

#### ❌ 実装されていないAI
- **繁殖AI (`BreedGoal`)**: 意図的に除外
- 他の動物との交配や発情行動は一切行わない

### 基底クラス
[ShikigamiEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/ShikigamiEntity.java)

---

## 実装済みの式神

### 1. 紙の牛 (Paper Cow)

#### 基本情報
- **登録名**: `paper_cow`
- **HP**: 6.0 (3ハート)
- **サイズ**: 0.9F x 1.4F
- **移動速度**: 0.25D

#### ゲームプレイ機能
| 機能 | 仕様 | 実装状況 |
|------|------|----------|
| **ミルクの取得** | ✅ バケツで取得可能 | 実装済み |
| **誘引アイテム** | 小麦 | 実装済み |
| **繁殖** | ❌ 不可 | 正しく無効化済み |
| **ドロップ** | 召喚アイテムのみ | 実装済み |

#### 実装ファイル
- Entity: [PaperCowEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/PaperCowEntity.java)
- Loot Table: [paper_cow.json](../src/main/resources/data/kamigami/loot_table/entities/paper_cow.json)

---

### 2. 紙の鶏 (Paper Chicken)

#### 基本情報
- **登録名**: `paper_chicken`
- **HP**: 4.0 (2ハート)
- **サイズ**: 0.4F x 0.7F
- **移動速度**: 0.25D

#### ゲームプレイ機能
| 機能 | 仕様 | 実装状況 |
|------|------|----------|
| **卵を産む** | ✅ 定期的に卵を産む（6000～12000tick） | 実装済み |
| **誘引アイテム** | 各種種（小麦の種、メロンの種、など） | 実装済み |
| **繁殖** | ❌ 不可 | 正しく無効化済み |
| **ドロップ** | 召喚アイテムのみ | 実装済み |

#### 産卵の仕様
- 産卵間隔: 6000～12000tick（5～10分）
- 条件: 生存、成体、サーバー側のみ
- 実装場所: [PaperChickenEntity.java:53-62](../src/main/java/com/hydryhydra/kamigami/entity/PaperChickenEntity.java#L53-L62)

#### 実装ファイル
- Entity: [PaperChickenEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/PaperChickenEntity.java)
- Loot Table: [paper_chicken.json](../src/main/resources/data/kamigami/loot_table/entities/paper_chicken.json)

---

### 3. 紙の羊 (Paper Sheep)

#### 基本情報
- **登録名**: `paper_sheep`
- **HP**: 5.0 (2.5ハート)
- **サイズ**: 0.9F x 1.3F
- **移動速度**: 0.25D

#### ゲームプレイ機能
| 機能 | 仕様 | 実装状況 |
|------|------|----------|
| **羊毛の取得** | ✅ ハサミで刈り取り可能（白色の羊毛1～3個） | 実装済み |
| **羊毛の再生** | ✅ 草を食べることで再生 | 実装済み |
| **誘引アイテム** | 小麦 | 実装済み |
| **繁殖** | ❌ 不可 | 正しく無効化済み |
| **ドロップ** | 召喚アイテムのみ | 実装済み |

#### 刈り取りの仕様
- ハサミで右クリック
- 1～3個の白色の羊毛を落とす
- 刈り取り状態は `EntityDataAccessor` で管理
- 草を食べると羊毛が再生

#### 羊毛の色
- **現在**: 白色固定
- **将来**: 染色機能を追加予定（バニラの羊と同様）

#### 実装ファイル
- Entity: [PaperSheepEntity.java](../src/main/java/com/hydryhydra/kamigami/entity/PaperSheepEntity.java)
- Loot Table: [paper_sheep.json](../src/main/resources/data/kamigami/loot_table/entities/paper_sheep.json)

---

## ドロップ仕様の詳細

### 共通ルール
すべての式神は、倒されると**召喚アイテムをドロップ**します。

#### Loot Table仕様
```json
{
  "type": "minecraft:entity",
  "pools": [
    {
      "rolls": 1,
      "entries": [
        {
          "type": "minecraft:item",
          "name": "kamigami:<summon_item_name>"
        }
      ]
    }
  ]
}
```

### 重要な仕様
- **条件なし**: プレイヤーに倒されなくてもドロップする
- **確定ドロップ**: 必ず1個ドロップ
- **召喚アイテムのみ**: バニラの肉、皮、羽などはドロップしない

### リサイクルの利点
式神を倒すと召喚アイテムが戻ってくるため、以下のメリットがあります：

1. **無限再召喚**: アイテムを失わずに式神を使い続けられる
2. **移動手段**: 式神を倒してアイテム化し、別の場所で再召喚できる
3. **在庫管理**: 不要な式神を倒してインベントリを整理できる

---

## 資源取得の詳細

### 取得可能な資源

| 式神 | 資源 | 取得方法 | バニラとの違い |
|------|------|----------|----------------|
| 紙の牛 | ミルク | バケツで右クリック | 同じ |
| 紙の鶏 | 卵 | 自動的に産む | 同じ |
| 紙の羊 | 白色の羊毛 | ハサミで刈り取り | 色が白色固定 |

### 取得不可能な資源
以下のバニラ資源は取得できません：

- **生の牛肉・革** (牛)
- **生の鶏肉・羽** (鶏)
- **生の羊肉** (羊)

これにより、式神は**完全な代替手段ではなく、補助的な存在**として機能します。

---

## 仕様の実装チェックリスト

新しい式神を追加する際や、既存の式神を確認する際に使用してください。

### 基本チェック

- [ ] HPが低く設定されている（バニラより低い）
- [ ] `getBreedOffspring()` が `null` を返す
- [ ] `BreedGoal` が `registerGoals()` に登録されていない
- [ ] Loot Tableが召喚アイテムのみをドロップする
- [ ] 召喚アイテムのスタック数が16に設定されている

### AI動作チェック

- [ ] `FloatGoal` が登録されている
- [ ] `PanicGoal` が登録されている
- [ ] `TemptGoal` が適切な食べ物で登録されている
- [ ] `WaterAvoidingRandomStrollGoal` が登録されている
- [ ] `LookAtPlayerGoal` が登録されている

### エンティティ固有機能チェック

#### 紙の牛
- [ ] バケツでミルクが取得できる
- [ ] 小麦で誘引される

#### 紙の鶏
- [ ] 定期的に卵を産む
- [ ] 各種種で誘引される

#### 紙の羊
- [ ] ハサミで羊毛が刈り取れる
- [ ] 草を食べて羊毛が再生する
- [ ] 小麦で誘引される

### ファイル構成チェック

- [ ] エンティティクラスが存在する
- [ ] Loot Tableが存在する
- [ ] 召喚アイテムが登録されている
- [ ] クリエイティブタブに追加されている
- [ ] 翻訳ファイルにエントリがある

---

## 将来の拡張案

### 追加予定の機能
以下の機能は現在未実装ですが、将来的に追加を検討しています：

1. **式神の色バリエーション**
   - 紙の羊の染色機能
   - 紙の鶏、紙の牛のバリエーション

2. **新しい式神**
   - 紙の豚（キャロットで誘引、サドル騎乗可能）
   - 紙のウサギ（小さく素早い）
   - 紙の馬（騎乗可能）

3. **召喚アイテムのクラフトレシピ**
   - 式神コアアイテムを使用したレシピ
   - 紙 + 特定のアイテムで召喚アイテムを作成

4. **式神の強化システム**
   - アイテムを使ってHPや能力を強化
   - レベルアップシステム

5. **式神の視覚的差別化**
   - テクスチャの追加（現在未作成）
   - パーティクルエフェクト
   - 紙らしいアニメーション

---

## 仕様変更履歴

### 2025-11-09
- **祠システムの追加**
  - 祠ブロック（アイテム保管、破壊時の災い）を実装
  - 3種類の災いシステム（通常、沼の神、豊穣の神）を実装
  - 祟りスライム（サイズ1/2/4、分裂システム）を実装
  - 豊穣の祟り（木型モンスター、遠距離攻撃）を実装
  - 御神体アイテム2種（沼の神、豊穣の神）を実装
- **ゲームプレイ仕様書の大幅更新**
  - 祠システムの詳細仕様を追加
  - 目次に祠システムを追加（優先順位を最上位に）

### 2025-11-07
- **繁殖システムの完全無効化**
  - すべての式神から `BreedGoal` を削除
  - これにより発情モードが発生しないようになった
- **Loot Tableの統一**
  - `paper_sheep.json` から `killed_by_player` 条件を削除
  - すべての式神が常に召喚アイテムをドロップするよう統一
- **PaperSheepEntityのバグ修正**
  - NBT読み込み時の `.orElse()` エラーを修正
- **このドキュメントの初版作成**

---

## 開発者向けノート

### ゲームプレイ仕様の変更時
1. このドキュメントを更新する
2. 実装を確認する（チェックリスト使用）
3. コンパイルテストを実行する
4. 可能であればゲーム内テストを実施する

### 新しい式神の追加時
1. このドキュメントの「実装済みの式神」セクションに追記
2. チェックリストを使用して実装を確認
3. 仕様変更履歴に記録

### 新しい祠の災いを追加する場合
1. このドキュメントの「祠の災いシステム」セクションに追記
2. 御神体アイテムを定義
3. `ShrineBlock.java` の `playerWillDestroy()` メソッドに分岐を追加
4. 仕様変更履歴に記録

### 参考リンク
- [エンティティ実装ガイド](entity-implementation-guide.md)
- [NeoForge注意点](neoforge-gotchas.md)
- [プロジェクト構造](project-structure.md)

---

**最終更新日**: 2025-11-09
**バージョン**: 1.1
**対象**: KamiGami Mod v0.0.1 (Minecraft 1.21.10 / NeoForge 21.10.43-beta)
