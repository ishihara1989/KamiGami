# ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€**Spotless**ã‚’ä½¿ç”¨ã—ã¦Javaã‚³ãƒ¼ãƒ‰ã¨JSONãƒ•ã‚¡ã‚¤ãƒ«ã®è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¡Œã„ã¾ã™ã€‚

## ğŸ¯ æ¦‚è¦

- **Java**: Eclipse JDT Formatterï¼ˆ4ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼‰
- **JSON**: Gson Formatterï¼ˆ2ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆï¼‰
- **ãã®ä»–**: Gradleã€Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®æœ«å°¾ç©ºç™½å‰Šé™¤

## ğŸ“ åˆ©ç”¨å¯èƒ½ãªGradleã‚¿ã‚¹ã‚¯

### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆä¿®æ­£ã—ãªã„ï¼‰

```bash
./gradlew.bat spotlessCheck
```

ã‚³ãƒ¼ãƒ‰ãŒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¦å‰‡ã«å¾“ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚é•åãŒã‚ã‚Œã°ã‚¨ãƒ©ãƒ¼ã‚’å ±å‘Šã—ã¾ã™ã€‚

### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è‡ªå‹•é©ç”¨

```bash
./gradlew.bat spotlessApply
```

å…¨ã¦ã®Javaãƒ•ã‚¡ã‚¤ãƒ«ã¨JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•çš„ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã—ã¾ã™ã€‚

### ç‰¹å®šã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã¿å®Ÿè¡Œ

```bash
# Javaã®ã¿
./gradlew.bat spotlessJava

# JSONã®ã¿
./gradlew.bat spotlessJson

# ãã®ä»–ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.gradle, .md ãªã©ï¼‰ã®ã¿
./gradlew.bat spotlessMisc
```

## ğŸª Git Pre-commitãƒ•ãƒƒã‚¯

### è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ©Ÿèƒ½

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€**ã‚³ãƒŸãƒƒãƒˆå‰ã«è‡ªå‹•çš„ã«ã‚³ãƒ¼ãƒ‰ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ**ã™ã‚‹pre-commitãƒ•ãƒƒã‚¯ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚

#### å‹•ä½œã®æµã‚Œ

1. `git commit` ã‚’å®Ÿè¡Œ
2. pre-commitãƒ•ãƒƒã‚¯ãŒè‡ªå‹•å®Ÿè¡Œ
3. `spotlessApply` ã§ã‚³ãƒ¼ãƒ‰ã‚’è‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
4. ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•çš„ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°
5. ã‚³ãƒŸãƒƒãƒˆå®Œäº†

#### ãƒ•ãƒƒã‚¯ã®å ´æ‰€

- `.git/hooks/pre-commit` - Bash/Git Bashã§å®Ÿè¡Œ
- `.git/hooks/pre-commit.bat` - Windowsã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§å®Ÿè¡Œ

### æ³¨æ„ç‚¹

- **åˆå›ã‚³ãƒŸãƒƒãƒˆæ™‚ã¯æ™‚é–“ãŒã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™**ï¼ˆä¾å­˜é–¢ä¿‚ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒé©ç”¨ã•ã‚ŒãŸå ´åˆã€è‡ªå‹•çš„ã«ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¾ã™
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ã®çŠ¶æ…‹ã§ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰å“è³ªãŒä¸€å®šã«ä¿ãŸã‚Œã¾ã™

## âš™ï¸ ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šã®è©³ç´°

### Javaãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

[build.gradle](../build.gradle#L174-L191) ã§è¨­å®šï¼š

```gradle
java {
    target 'src/*/java/**/*.java'

    eclipse()              // Eclipse JDT Formatter
    endWithNewline()       // ãƒ•ã‚¡ã‚¤ãƒ«æœ«å°¾ã«æ”¹è¡Œ
    removeUnusedImports()  // æœªä½¿ç”¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚’å‰Šé™¤
    trimTrailingWhitespace()  // è¡Œæœ«ç©ºç™½ã‚’å‰Šé™¤
    indentWithSpaces(4)    // 4ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ
}
```

### JSONãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```gradle
json {
    target 'src/*/resources/**/*.json'

    gson()
        .indentWithSpaces(2)  // 2ã‚¹ãƒšãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ

    trimTrailingWhitespace()
    endWithNewline()
}
```

### ãã®ä»–ãƒ•ã‚¡ã‚¤ãƒ«

```gradle
format 'misc', {
    target '*.gradle', '*.md', '.gitignore'

    trimTrailingWhitespace()
    endWithNewline()
}
```

## ğŸš€ ä½¿ã„æ–¹ã®ä¾‹

### é–‹ç™ºä¸­ã®æ—¥å¸¸çš„ãªä½¿ã„æ–¹

```bash
# ã‚³ãƒ¼ãƒ‰ã‚’ç·¨é›†
# ...

# ã‚³ãƒŸãƒƒãƒˆå‰ã«ç¢ºèªã—ãŸã„å ´åˆï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
./gradlew.bat spotlessCheck

# é€šå¸¸é€šã‚Šã‚³ãƒŸãƒƒãƒˆï¼ˆè‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæœ‰åŠ¹ï¼‰
git add .
git commit -m "æ©Ÿèƒ½è¿½åŠ "

# pre-commitãƒ•ãƒƒã‚¯ãŒè‡ªå‹•çš„ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’é©ç”¨
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¸ˆã¿ã®ã‚³ãƒ¼ãƒ‰ãŒã‚³ãƒŸãƒƒãƒˆã•ã‚Œã¾ã™
```

### æ‰‹å‹•ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’é©ç”¨ã—ãŸã„å ´åˆ

```bash
# å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
./gradlew.bat spotlessApply

# ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°
git add .

# ã‚³ãƒŸãƒƒãƒˆ
git commit -m "ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé©ç”¨"
```

### æ—¢å­˜ã®ã‚³ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ã¦ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ

```bash
# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
./gradlew.bat spotlessApply

# å¤‰æ›´ã‚’ç¢ºèª
git diff

# å•é¡Œãªã‘ã‚Œã°ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ"
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### pre-commitãƒ•ãƒƒã‚¯ãŒå‹•ä½œã—ãªã„

**Git Bashã®å ´åˆ:**
```bash
# ãƒ•ãƒƒã‚¯ã«å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
chmod +x .git/hooks/pre-commit
```

**Windowsã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å ´åˆ:**
- `.git/hooks/pre-commit.bat` ãŒè‡ªå‹•çš„ã«ä½¿ç”¨ã•ã‚Œã¾ã™
- å®Ÿè¡Œæ¨©é™ã®è¨­å®šã¯ä¸è¦ã§ã™

### ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹

```bash
# ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’ç¢ºèª
./gradlew.bat spotlessCheck

# è‡ªå‹•ä¿®æ­£ã‚’è©¦ã™
./gradlew.bat spotlessApply

# ãã‚Œã§ã‚‚è§£æ±ºã—ãªã„å ´åˆ
./gradlew.bat clean spotlessApply
```

### pre-commitãƒ•ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ãŸã„å ´åˆ

```bash
# ã‚³ãƒŸãƒƒãƒˆæ™‚ã«ãƒ•ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆéæ¨å¥¨ï¼‰
git commit --no-verify -m "ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"
```

**æ³¨æ„:** `--no-verify` ã®ä½¿ç”¨ã¯æ¨å¥¨ã•ã‚Œã¾ã›ã‚“ã€‚ã‚³ãƒ¼ãƒ‰ã®ä¸€è²«æ€§ãŒä¿ãŸã‚Œãªããªã‚Šã¾ã™ã€‚

## ğŸ“Š CI/CDã§ã®ä½¿ç”¨

ç¶™ç¶šçš„ã‚¤ãƒ³ãƒ†ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆCIï¼‰ã§ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã‚’è¡Œã†å ´åˆï¼š

```bash
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆé•åãŒã‚ã‚Œã°ãƒ“ãƒ«ãƒ‰å¤±æ•—
./gradlew.bat spotlessCheck
```

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã•ã‚Œã¦ã„ãªã„ã‚³ãƒ¼ãƒ‰ãŒãƒãƒ¼ã‚¸ã•ã‚Œã‚‹ã“ã¨ã‚’é˜²ãã¾ã™ã€‚

## âœ… ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **ã‚³ãƒŸãƒƒãƒˆå‰ã«å¿…ãšè‡ªå‹•ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’é©ç”¨**
   - pre-commitãƒ•ãƒƒã‚¯ãŒè‡ªå‹•çš„ã«è¡Œã„ã¾ã™

2. **å®šæœŸçš„ã«`spotlessCheck`ã‚’å®Ÿè¡Œ**
   - ã‚³ãƒ¼ãƒ‰å“è³ªã‚’ç¶­æŒ

3. **ãƒãƒ¼ãƒ å…¨ä½“ã§åŒã˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¨­å®šã‚’ä½¿ç”¨**
   - å·®åˆ†ãŒè¦‹ã‚„ã™ããªã‚Šã¾ã™

4. **å¤§è¦æ¨¡ãªãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›´ã¯åˆ¥ã‚³ãƒŸãƒƒãƒˆã§**
   - ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã‚„ã™ããªã‚Šã¾ã™

## ğŸ”— å‚è€ƒãƒªãƒ³ã‚¯

- [Spotlesså…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/diffplug/spotless)
- [Spotless Gradle Plugin](https://github.com/diffplug/spotless/tree/main/plugin-gradle)
- [Eclipse JDT Formatter](https://help.eclipse.org/latest/index.jsp)

## âš ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### Spotlessã€ŒJVM-local cache is staleã€ã‚¨ãƒ©ãƒ¼

æ–­ç¶šçš„ã«ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼š

```
Execution failed for task ':spotlessJava'.
> Error while evaluating property 'lineEndingsPolicy' of task ':spotlessJava'.
   > Spotless JVM-local cache is stale. Regenerate the cache with
       rmdir /q /s .gradle/configuration-cache
```

**å¯¾å‡¦æ–¹æ³•:**

1. **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ**ï¼ˆæ¨å¥¨ï¼‰
   ```bash
   # Git Bashç’°å¢ƒ
   ./clean-config-cache.sh

   # Windowsã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
   clean-config-cache.bat
   ```

2. **æ‰‹å‹•ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢**
   ```bash
   rm -rf .gradle/configuration-cache
   ```

3. **Spotlessã‚’å†å®Ÿè¡Œ**
   ```bash
   ./gradlew spotlessApply
   ```

**è©³ç´°:**
å®Œå…¨ãªãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰ã¯ [spotless-cache-troubleshooting.md](spotless-cache-troubleshooting.md) ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

**ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å®Ÿè£…æ¸ˆã¿ã®äºˆé˜²ç­–:**
- Spotless 8.0.0ã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ï¼ˆæ§‹æˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å®Œå…¨å¯¾å¿œï¼‰
- æ§‹æˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- Git pre-commitãƒ•ãƒƒã‚¯ã«ã‚ˆã‚‹è‡ªå‹•å¯¾å¿œ

---

**æœ€çµ‚æ›´æ–°æ—¥:** 2025-11-11
